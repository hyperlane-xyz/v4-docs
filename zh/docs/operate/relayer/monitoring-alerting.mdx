---
title: "监控与告警"
---

Relayer 在参数指定的端口号上公开指标。端口是默认值，但可以选择任何有效的端口。

我们建议使用 Prometheus 抓取这些指标，并使用 Grafana 进行可视化，使用[此仪表板 JSON 模板](https://github.com/hyperlane-xyz/hyperlane-monorepo/blob/2f7f714c5b698fedcead9825f52da6ef95f96be1/tools/grafana/easy-relayer-dashboard-template.json)，如下所示。此仪表板的优势在于它可以同时显示多个 validator。截图显示了按链或按 kubernetes pod 分组的指标。

![Relayer Grafana Dashboard Template](/images/docs/operate/dashboard-template-relayer.png)

<Note>
  如果作为 Docker 镜像运行，请确保端口转发指标端点端口。例如，要将端口 9090 转发到本地端口 80，请在您的 `docker run` 命令中添加以下标志：`-p 9090:80`
</Note>

## 指标

仪表板模板包含以下指标。

| 指标                                                            | 描述                                                                                                                                                                                                                                                                                |
| -------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `hyperlane_messages_processed_count`                           | Relayer 按源链和目标链处理的消息（"Messages Processed"）。                                                                                                                                                                                                                          |
| `hyperlane_submitter_queue_length{queue_name="prepare_queue"}` | submitter 的 prepare 队列长度（"Prepare Queues"）。每个目标链都有一个正在运行的 submitter，所有待处理/可重试的消息最终都会进入 prepare 队列，等待（重新）提交。此队列增加可能意味着消息量超过了 Relayer 的处理吞吐量，或者由于各种原因（RPC 故障、余额不足）提交失败。 |
| `hyperlane_submitter_queue_length{queue_name="submit_queue"}`  | submitter 的 submit 队列长度（"Submit Queues"）。这些是已准备好但尚未提交的消息。                                                                                                                                                                                                    |
| `hyperlane_submitter_queue_length{queue_name="confirm_queue"}` | submitter 的 confirm 队列长度（"Confirm Queues"）。这些是已提交但尚未确认（最终确定）的消息。                                                                                                                                                                                        |

其他相关指标包括：

| 指标                                                                | 描述                                                                                                                                                                                                                                                              |
| ------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `hyperlane_request_count`                                           | 使用以下标签记录成功或失败的 RPC 数量：`chain`、`status`（失败或成功）、`provider_node`（负责的 base RPC URL）和 RPC `method`。适用于所有 agent，但目前仅在 EVM 链上支持。                                                                                        |
| `hyperlane_wallet_balance{agent="relayer"}`                         | Relayer 在每条链上的余额，以最小面额单位表示                                                                                                                                                                                                                      |
| `hyperlane_critical_error`                                          | 链上关键错误的布尔标记，表示活跃度丢失。                                                                                                                                                                                                                          |
| `hyperlane_block_height`                                            | agent 连接的 RPC 节点的区块高度。如果此指标没有增加，则 RPC 可能不健康，需要更改。                                                                                                                                                                                 |
| `hyperlane_span_events_total{agent="relayer", event_level="error"}` | 记录的错误总数。如果此指标在最后一小时的导数超过 1，则至少应发出低严重性警报。请注意，仪表板查询按 kubernetes pod 名称对指标进行分组，因此如果您不在 kubernetes 环境中运行，可能需要调整此查询。                                                                  |
| `hyperlane_span_events_total{agent="relayer", event_level="warn"}`  | 记录的警告总数。如果此指标在最后一小时的导数超过 1，则至少应发出低严重性警报。请注意，仪表板查询按 kubernetes pod 名称对指标进行分组，因此如果您不在 kubernetes 环境中运行，可能需要调整此查询。                                                                  |

## 告警

可以结合上述指标创建告警以最小化误报。一些关键告警示例：

### 对于所有 agent

- 任何链的 `hyperlane_block_height` 在过去 15 分钟内没有增加
- 过去 10 分钟内 `hyperlane_request_count{status="failure"}` 的速率 > `hyperlane_request_count{status=~"success|failure"}` 速率的 60%。大多数 agent 问题都是由于 RPC 故障，这可能会捕获这些问题。

### 对于 Relayer

- 某条链的 `hyperlane_critical_error` 为 `1`，表示 Relayer 在该链上失去了活跃度。虽然其他链上的操作不受此影响，但这是一个高严重性警报 - 通常与受影响链的不可靠 RPC 有关。
- 使用 `hyperlane_submitter_queue_length{queue_name="prepare_queue"}`，prepare 队列长度在过去 30 分钟内一直在增加，confirm 队列长度为零，错误/警告计数差异一直在增加。这可能意味着 Relayer 的余额已用完，无法支付 gas，或者目标链 RPC URL 无法正常工作，或者所有新消息都无法处理
- `hyperlane_wallet_balance` 已降至某个阈值以下。例如，当前余额除以过去 24 小时的差值小于 2，意味着必须在两天内充值

如果您收到警报，请始终检查日志以了解可能的问题。
